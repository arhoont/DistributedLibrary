{% extends "library/base.html" %}
{% csrf_token %}
{% load static %}

{% block title %}Распределенная библиотека{% endblock %}
{% block include %}

    <link rel="stylesheet" href="{% static "css/formcss.css" %}">
    <link rel="stylesheet" href="{% static "css/bookinfo.css" %}">
    <script type="text/javascript" charset="utf-8" src="{% static "js/bookinfo.js" %}"></script>
    <script type="text/javascript" charset="utf-8" src="{% static "js/jquery.printElement.js" %}"></script>
{% endblock %}
{% block content %}
    <span class="alertSpan"></span>

    <div class="row">
        <div class="form-wrapper" id="ba-form-wrapper">

            <div class="form-div" id="ba-form-div">
                <div>
                    <div class="form-header">
                        <h3>
                            <a href="/" class="btn pull-left" type="button" id="back-btn"><i
                                    class="icon-arrow-left icon-white"></i>
                            </a>
                            <span>Информация</span>
                        </h3>
                    </div>
                    <div class="form-body pull-left">
                        <form class="form-horizontal" action="" method="post" id="ba-form-r">
                            {% csrf_token %}
                            <div class="row">
                                <div class="" id="image-div">
                                    <a href="#" class="thumbnail">
                                        {% if book.image %}
                                            <img src="{{ MEDIA_URL }}{{ book.image }}" alt="" id="b-img">
                                        {% else %}
                                            <img src="{{ STATIC_URL }}img/no_book.png" alt="" id="b-img">
                                        {% endif %}

                                    </a>
                                </div>
                                <div class="span5 right-inputs">
                                    <div class="control-group" id="ba-link-cg">
                                        <label class="control-label" for="ba-link">Ссылка:</label>

                                        <div class="controls">
                                            <a href="{{ book.ozon }}" id="ba-link"
                                               name="ba-link">{{ book.ozon }}</a>
                                            <span class="help-inline"></span>
                                        </div>
                                    </div>
                                    <div class="control-group" id="ba-isbn-cg">
                                        <label class="control-label" for="ba-isbn">ISBN:</label>

                                        <div class="controls">
                                            <span id="ba-isbn" name="ba-isbn">{{ book.isbn }}</span>
                                            <script>isbn = "{{ book.isbn }}"</script>
                                            <span class="help-inline"></span>
                                        </div>
                                    </div>
                                    <div class="control-group" id="ba-title-cg">
                                        <label class="control-label" for="ba-title">Название:</label>

                                        <div class="controls">
                                            <span id="ba-title" name="ba-title">{{ book.title }}</span>
                                            <span class="help-inline"></span>
                                        </div>

                                    </div>
                                    <div class="control-group" id="ba-lang-cg">
                                        <label class="control-label" for="ba-lang">Язык:</label>

                                        <div class="controls">
                                            <span id="ba-lang" name="ba-lang">{{ book.language.language }}</span>
                                        </div>
                                    </div>
                                    <div class="control-group" id="ba-count-cg">
                                        <label class="control-label" for="ba-count">Кол-во:</label>

                                        <div class="controls">
                                            <span id="ba-lang" name="ba-count">{{ bcount }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <form class="" action="" method="post" id="ba-form-b">
                            {% csrf_token %}
                            <div class="row">
                                <div class="span2 control-group" id="ba-auth-cg">
                                    <label class="control-label" for="ba-auth">Авторы</label>

                                    <div class="controls" id="authicontrol">
                                        {% for auth in bauthors %}
                                            <div>{{ auth }}</div>
                                        {% endfor %}
                                    </div>
                                </div>


                                <div class="control-group span2" id="ba-key-cg">
                                    <label class="control-label" for=ba-key>Ключевые слова:</label>

                                    <div class="controls" id="keywordsf">
                                        {% for key in bkeywords %}
                                            <div>{{ key }}</div>
                                        {% endfor %}
                                    </div>

                                </div>
                            </div>
                            <div id="butsdiv">
                                {#<button type="button" class="btn btn-primary">Взять</button>#}
{#                                <button type="button" class="btn btn-primary">Взять случайный экземпляр</button>#}
                                <button type="button" class="btn btn-info" id="addOpinionB">Оставить отзыв</button>
                                <button type="button" class="btn btn-info">Добавить ссылку</button>
                                <button type="button" class="btn btn-info" id="addItemBut">Добавить экземпляр</button>
                            </div>
                        </form>
                    </div>
                    <div class="pull-left" id="itemsTalbeDiv">
                        <caption class="caption"><strong>Экземпляры:</strong></caption>
                        <table class="table table-condensed" id="itemsTalbeDiv">
                            <thead>
                            <tr class="headRow">
                                <th onclick="">id</th>
                                <th onclick="">Владелец</th>
                                <th onclick="">Читатель</th>
                                <th onclick="">Ценность</th>
                            </tr>
                            </thead>
                            <tbody id="rows">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="control-group" id="ba-desc-cg">
                <label class="control-label" for=ba-desc><h4>Описание:</h4></label>

                <div class="controls">
                    <div id="ba-desc">{{ book.description }}</div>
                    {#                                        <textarea rows=4 id="ba-desc" name="ba-desc" placeholder="Описание" readonly>{{ book.description }}</textarea>#}
                </div>
            </div>
            <div id="opinions">
                <h4>Отзывы:</h4>
                {% load apptags %}
                {% for op in opinions %}
                    <hr>

                    <div>
                        {% for i in op.rating|times %}
                            <i class="icon-star icon-white"></i>
                        {% endfor %}
                    </div>
                    <div class="muted">
                        <small>{{ op.person.fname }} {{ op.person.lname }}, {{ op.date }}</small>
                    </div>
                    <div class="optext">{{ op.text }}</div>
                {% endfor %}
            </div>

        </div>

    </div>

    <div id="addItemModal" class="modal hide" tabindex="-1" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3 id="myModalLabel">Добавить экземпляр</h3>
        </div>
        <div class="modal-body">
            <p>Вы уверены, что у вас есть книга <strong>"{{ book.title }}"</strong>и вы хотите добавить свой экземпляр в
                библиотеку?</p>
            <strong>Выберите ценность:</strong>

            <div class="btn-group" id="ba-val" data-toggle="buttons-radio">
                <button type="button" class="btn btn-info">1</button>
                <button type="button" class="btn btn-info active">2</button>
                <button type="button" class="btn btn-info">3</button>
            </div>
            <a class="infoValuesButton" data-toggle="popover" data-placement="right" data-trigger="hover"
               data-content="Ценность позволяет установить количество запросов...а аааааааааааааа"
               title="Ценность">
                <i class="icon-question-sign icon-white"></i></a>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">Закрыть</button>
            <button class="btn btn-primary" id="addItemB">Добавить</button>
        </div>
    </div>

    <div id="opinionModal" class="modal hide" tabindex="-1" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3 id="myModalLabel">Оставить отзыв</h3>
        </div>
        <div class="modal-body">
            <strong>Рейтинг:</strong>

            <div class="btn-group" id="ba-rating" data-toggle="buttons-radio">
                <button type="button" class="btn btn-info btn-mini">1</button>
                <button type="button" class="btn btn-info btn-mini">2</button>
                <button type="button" class="btn btn-info btn-mini active">3</button>
                <button type="button" class="btn btn-info btn-mini">4</button>
                <button type="button" class="btn btn-info btn-mini">5</button>
            </div>
            <div>
                <textarea rows="6" id="opinionTextArea"></textarea>
            </div>
        </div>

        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">Закрыть</button>
            <button class="btn btn-primary" id="addOpinion">Написать</button>
        </div>
    </div>

    <div id="takeModal" class="modal hide" tabindex="-1" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3 id="myModalLabel">Вы уверены?</h3>
        </div>
        <div class="modal-body">

        </div>

        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">Отмена</button>
            <button class="btn btn-info">Справка</button>
            <button class="btn btn-primary" id="takeButtonModal">Послать запрос</button>
        </div>
    </div>

    <div id="printModal" class="modal hide" tabindex="-1" role="dialog">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3 id="myModalLabel">Экземпляр добавлен</h3>
        </div>

        <div class="modal-body">
            <h5 class="text-center"> Распечатайте стикер и наклейте его на книгу</h5>

            <div id="sticker" style="display: inline-block;border: 1px solid #e5e5e5;border-radius: 4px;padding: 5px;">
                <div style="font-weight: bold; text-align: center">{{ libname }}</div>
                <div><span>№ экземпляра: </span><span style="font-weight: bold;" class="biid">1</span></div>
                <span>Владелец: </span>

                <div class="username" style="margin-left: 10px;">{{ person.fname }} {{ person.lname }}</div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" data-dismiss="modal">Закрыть</button>
            <button class="btn btn-primary" id="printBtn"><i class="icon-print icon-white"></i> Печать</button>
        </div>
    </div>
    <script>
        var authors = {{authors|safe}};
        var keywords = {{keywords|safe}};
    </script>
{% endblock %}